{% extends 'base.html' %}

{% block title %} テスト結果 {% endblock %}

{% block main %}
	<div class="container mt-5">
	    <h2>結果</h2>
	    <p>問題集：{{ score.question_set }}</p>
	    <p>解答日時：{{ score.date }}</p>
	    <p>回数：{{ score.times }}回目</p>
	    <p>問題数：{{ question_count }}</p>
	    <p>正解数：{{ score.score }}</p>
	    
	    <h3>各問題の正誤</h3>
        <ul>
            {% for question, result in question_results.items %}
                <li>{{ question }}: {{ result }}</li>
            {% endfor %}
        </ul>
	    
	    <div style="width: 300px; height: 300px;">
	    	<canvas id="myChart" width="400" height="400"></canvas>
	    </div>
	    
	    <br><br>
	    <a href="{% url 'ba:result_list' %}" class="btn btn-secondary">テスト結果一覧</a>
	    <br><br>
	    <a href="{% url 'ba:questionset_list' %}" class="btn btn-secondary">問題集一覧</a>
	</div>
	
	<script>
        // 正答率を計算
        var correctCount = {{ score.score }};
        var totalCount = {{ question_count }};
        var correctRate = (correctCount / totalCount) * 100;

        // Chart.jsを使用して円グラフを描画
        var ctx = document.getElementById('myChart').getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['正解', '不正解'],
                datasets: [{
                    data: [correctCount, totalCount - correctCount],
                    backgroundColor: [
                        'rgba(54, 162, 235, 0.5)',
                        'rgba(255, 99, 132, 0.5)'
                    ],
                    borderColor: [
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 99, 132, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
            	plugins: {
                    tooltip: true, // ツールチップを非表示にする
                    legend: true // 凡例を非表示にする
                },
                title: {
                    display: true,
                    text: '正答率: ' + correctRate.toFixed(2) + '%',
                    fontSize: 18,
                    position: 'top', // テキストを上部に表示する
                    fontStyle: 'bold'
                }
                
            }
        });
    </script>
{% endblock %}